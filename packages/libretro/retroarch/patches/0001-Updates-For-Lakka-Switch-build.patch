From 670bce6b6bc35b6321903e52a5d2453c8c6e8f96 Mon Sep 17 00:00:00 2001
From: Ronald Brown <rbrown4014@yahoo.com>
Date: Thu, 6 May 2021 10:20:12 -0700
Subject: [PATCH] Updates For Lakka Switch build.

---
 frontend/drivers/platform_unix.c |  4 ----
 intl/msg_hash_ar.h               |  4 ----
 intl/msg_hash_chs.h              |  4 ----
 intl/msg_hash_de.h               |  4 ----
 intl/msg_hash_es.h               |  4 ----
 intl/msg_hash_fi.h               |  4 ----
 intl/msg_hash_fr.h               |  4 ----
 intl/msg_hash_it.h               |  4 ----
 intl/msg_hash_ko.h               |  4 ----
 intl/msg_hash_pl.h               |  4 ----
 intl/msg_hash_pt_br.h            |  4 ----
 intl/msg_hash_ru.h               |  4 ----
 intl/msg_hash_tr.h               |  4 ----
 intl/msg_hash_us.h               |  4 ----
 menu/cbs/menu_cbs_get_value.c    |  4 ++++
 menu/cbs/menu_cbs_left.c         |  2 ++
 menu/cbs/menu_cbs_right.c        |  5 ++++-
 menu/cbs/menu_cbs_sublabel.c     |  5 ++++-
 menu/menu_displaylist.c          |  2 ++
 menu/menu_setting.c              | 13 +++----------
 20 files changed, 19 insertions(+), 68 deletions(-)

diff --git a/frontend/drivers/platform_unix.c b/frontend/drivers/platform_unix.c
index d48cc12fe3..43e818494f 100644
--- a/frontend/drivers/platform_unix.c
+++ b/frontend/drivers/platform_unix.c
@@ -1114,11 +1114,7 @@ static bool frontend_unix_powerstate_check_acpi_sysfs(
    {
       const char *node = retro_dirent_get_name(entry);
 
-#ifdef HAVE_LAKKA_SWITCH
-      if (node && strstr(node, "max170xx_battery"))
-#else
       if (node && (strstr(node, "BAT") || strstr(node, "battery")))
-#endif
          check_proc_acpi_sysfs_battery(node,
                &have_battery, &charging, seconds, percent);
    }
diff --git a/intl/msg_hash_ar.h b/intl/msg_hash_ar.h
index d8c45a7f1a..cf1d63949c 100644
--- a/intl/msg_hash_ar.h
+++ b/intl/msg_hash_ar.h
@@ -9084,10 +9084,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "تبديل GPU على مدار الساعة أو تحت الساعة."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "إعادة التشغيل إلى RCM"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_chs.h b/intl/msg_hash_chs.h
index ca5368a54c..936fb2211d 100644
--- a/intl/msg_hash_chs.h
+++ b/intl/msg_hash_chs.h
@@ -11304,10 +11304,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "超频或降频 Switch 的 GPU。"
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "重启到 RCM"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_de.h b/intl/msg_hash_de.h
index 4df3f8d9b5..e8df014223 100644
--- a/intl/msg_hash_de.h
+++ b/intl/msg_hash_de.h
@@ -10504,10 +10504,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "Über- oder Untertakten der Switch GPU."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "Neu starten im RCM"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_es.h b/intl/msg_hash_es.h
index 13f2712c59..2fcc7486b6 100644
--- a/intl/msg_hash_es.h
+++ b/intl/msg_hash_es.h
@@ -11336,10 +11336,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "Aumenta o reduce la velocidad de la GPU de Switch."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "Reiniciar al RCM"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_fi.h b/intl/msg_hash_fi.h
index 4e9839d0ab..c587358670 100644
--- a/intl/msg_hash_fi.h
+++ b/intl/msg_hash_fi.h
@@ -11216,10 +11216,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "Ylikellota tai alikellota Switchin näytönohjain."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "Käynnistä uudelleen RCM:ään"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_fr.h b/intl/msg_hash_fr.h
index 53f66185c9..7a02e6d191 100644
--- a/intl/msg_hash_fr.h
+++ b/intl/msg_hash_fr.h
@@ -11336,10 +11336,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "Overclocker ou underclocker le processeur graphique de la Switch."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "Redémarrer en mode RCM"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_it.h b/intl/msg_hash_it.h
index 61f8234efa..d2a025084a 100644
--- a/intl/msg_hash_it.h
+++ b/intl/msg_hash_it.h
@@ -11256,10 +11256,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "Overclocca o underclocca la GPU del Nintendo Switch."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "Riavvia in RCM"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_ko.h b/intl/msg_hash_ko.h
index b613b564e7..daba2ccc31 100644
--- a/intl/msg_hash_ko.h
+++ b/intl/msg_hash_ko.h
@@ -11468,10 +11468,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "스위치 GPU를 오버클럭 또는 언더클럭합니다."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "RCM 으로 다시 시작"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_pl.h b/intl/msg_hash_pl.h
index 4b0156d1ca..8802853d61 100644
--- a/intl/msg_hash_pl.h
+++ b/intl/msg_hash_pl.h
@@ -9976,10 +9976,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "Podkręcanie lub obniżanie GPU."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "Uruchom ponownie do RCM"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_pt_br.h b/intl/msg_hash_pt_br.h
index 6d7df25aa7..bda863bcdc 100644
--- a/intl/msg_hash_pt_br.h
+++ b/intl/msg_hash_pt_br.h
@@ -11292,10 +11292,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "Faz um overclock ou underclock na CPU do Switch."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "Reiniciar em RCM"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_ru.h b/intl/msg_hash_ru.h
index 8b801bd39c..7b62ce911b 100644
--- a/intl/msg_hash_ru.h
+++ b/intl/msg_hash_ru.h
@@ -11448,10 +11448,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "Разгон или замедление графического процессора Switch."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "Перезагрузка в RCM"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_tr.h b/intl/msg_hash_tr.h
index 6e6004c8b6..4af7433a20 100644
--- a/intl/msg_hash_tr.h
+++ b/intl/msg_hash_tr.h
@@ -10332,10 +10332,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "GPU hızını arttır yada düşür."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "RCM içinde yeniden başlat"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/intl/msg_hash_us.h b/intl/msg_hash_us.h
index 92381cb3ef..50f84e7af5 100644
--- a/intl/msg_hash_us.h
+++ b/intl/msg_hash_us.h
@@ -12202,10 +12202,6 @@ MSG_HASH(
    MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE,
    "Overclock or underclock the Switch GPU."
    )
-MSG_HASH(
-   MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-   "Reboot into RCM"
-   )
 #endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
 MSG_HASH(
diff --git a/menu/cbs/menu_cbs_get_value.c b/menu/cbs/menu_cbs_get_value.c
index 429c9e976a..f2a2ca9db7 100644
--- a/menu/cbs/menu_cbs_get_value.c
+++ b/menu/cbs/menu_cbs_get_value.c
@@ -516,6 +516,7 @@ static void menu_action_setting_disp_set_label_core_manager_entry(
    }
 }
 
+#ifndef HAVE_LAKKA_SWITCH
 #ifdef HAVE_LAKKA
 static void menu_action_setting_disp_set_label_cpu_policy(
       file_list_t* list,
@@ -589,6 +590,7 @@ static void menu_action_cpu_governor_label(
    strlcpy(s, d->scaling_governor, len);
 }
 #endif
+#endif
 
 static void menu_action_setting_disp_set_label_core_lock(
       file_list_t* list,
@@ -1782,6 +1784,7 @@ static int menu_cbs_init_bind_get_string_representation_compare_label(
             BIND_ACTION_GET_VALUE(cbs,
                   menu_action_setting_disp_set_label_core_option_override_info);
             break;
+         #ifndef HAVE_LAKKA_SWITCH
          #ifdef HAVE_LAKKA
          case MENU_ENUM_LABEL_CPU_POLICY_ENTRY:
             BIND_ACTION_GET_VALUE(cbs,
@@ -1795,6 +1798,7 @@ static int menu_cbs_init_bind_get_string_representation_compare_label(
             BIND_ACTION_GET_VALUE(cbs, menu_action_cpu_governor_label);
             break;
          #endif
+         #endif
          default:
             return -1;
       }
diff --git a/menu/cbs/menu_cbs_left.c b/menu/cbs/menu_cbs_left.c
index 1b7f49e554..bbe62cc687 100644
--- a/menu/cbs/menu_cbs_left.c
+++ b/menu/cbs/menu_cbs_left.c
@@ -1010,6 +1010,7 @@ static int menu_cbs_init_bind_left_compare_label(menu_file_list_cbs_t *cbs,
             case MENU_ENUM_LABEL_MANUAL_CONTENT_SCAN_CORE_NAME:
                BIND_ACTION_LEFT(cbs, manual_content_scan_core_name_left);
                break;
+            #ifndef HAVE_LAKKA_SWITCH
             #ifdef HAVE_LAKKA
             case MENU_ENUM_LABEL_CPU_POLICY_MAX_FREQ:
             case MENU_ENUM_LABEL_CPU_POLICY_MIN_FREQ:
@@ -1017,6 +1018,7 @@ static int menu_cbs_init_bind_left_compare_label(menu_file_list_cbs_t *cbs,
                BIND_ACTION_LEFT(cbs, cpu_policy_freq_tweak);
                break;
             #endif
+            #endif
             default:
                return -1;
          }
diff --git a/menu/cbs/menu_cbs_right.c b/menu/cbs/menu_cbs_right.c
index 000cfe373f..728c270ff0 100644
--- a/menu/cbs/menu_cbs_right.c
+++ b/menu/cbs/menu_cbs_right.c
@@ -789,6 +789,7 @@ static int manual_content_scan_core_name_right(unsigned type, const char *label,
    return 0;
 }
 
+#ifdef HAVE_LAKKA_SWITCH
 #ifdef HAVE_LAKKA
 static int cpu_policy_freq_tweak(unsigned type, const char *label,
       bool wraparound)
@@ -827,7 +828,7 @@ static int cpu_policy_freq_tweak(unsigned type, const char *label,
    return 0;
 }
 #endif
-
+#endif
 int core_setting_right(unsigned type, const char *label,
       bool wraparound)
 {
@@ -1129,6 +1130,7 @@ static int menu_cbs_init_bind_right_compare_label(menu_file_list_cbs_t *cbs,
             case MENU_ENUM_LABEL_MANUAL_CONTENT_SCAN_CORE_NAME:
                BIND_ACTION_RIGHT(cbs, manual_content_scan_core_name_right);
                break;
+            #ifndef HAVE_LAKKA_SWITCH
             #ifdef HAVE_LAKKA
             case MENU_ENUM_LABEL_CPU_POLICY_MAX_FREQ:
             case MENU_ENUM_LABEL_CPU_POLICY_MIN_FREQ:
@@ -1136,6 +1138,7 @@ static int menu_cbs_init_bind_right_compare_label(menu_file_list_cbs_t *cbs,
                BIND_ACTION_RIGHT(cbs, cpu_policy_freq_tweak);
                break;
             #endif
+            #endif
             default:
                return -1;
          }
diff --git a/menu/cbs/menu_cbs_sublabel.c b/menu/cbs/menu_cbs_sublabel.c
index cb0404e252..3c2851a4c1 100644
--- a/menu/cbs/menu_cbs_sublabel.c
+++ b/menu/cbs/menu_cbs_sublabel.c
@@ -1010,6 +1010,7 @@ static int action_bind_sublabel_bluetooth_list(
    return 0;
 }
 
+#ifndef HAVE_LAKKA_SWITCH
 #ifdef HAVE_LAKKA
 static int action_bind_sublabel_cpu_policy_entry_list(
       file_list_t *list,
@@ -1029,7 +1030,7 @@ static int action_bind_sublabel_cpu_policy_entry_list(
    return -1;
 }
 #endif
-
+#endif
 #ifdef HAVE_CHEEVOS
 static int action_bind_sublabel_cheevos_entry(
       file_list_t *list,
@@ -3942,9 +3943,11 @@ int menu_cbs_init_bind_sublabel(menu_file_list_cbs_t *cbs,
          case MENU_ENUM_LABEL_TIMEZONE:
             BIND_ACTION_SUBLABEL(cbs, action_bind_sublabel_timezone);
             break;
+#ifndef HAVE_LAKKA_SWITCH
          case MENU_ENUM_LABEL_CPU_POLICY_ENTRY:
             BIND_ACTION_SUBLABEL(cbs, action_bind_sublabel_cpu_policy_entry_list);
             break;
+#endif
 #endif
          case MENU_ENUM_LABEL_USER_LANGUAGE:
             BIND_ACTION_SUBLABEL(cbs, action_bind_sublabel_user_language);
diff --git a/menu/menu_displaylist.c b/menu/menu_displaylist.c
index 02df4ca3cf..438a161d10 100644
--- a/menu/menu_displaylist.c
+++ b/menu/menu_displaylist.c
@@ -9834,6 +9834,7 @@ bool menu_displaylist_ctl(enum menu_displaylist_ctl_state type,
          /* No-op */
          break;
 #endif
+#ifndef HAVE_LAKKA_SWITCH
 #ifdef HAVE_LAKKA
       case DISPLAYLIST_CPU_POLICY_LIST:
          menu_entries_ctl(MENU_ENTRIES_CTL_CLEAR, info->list);
@@ -9887,6 +9888,7 @@ bool menu_displaylist_ctl(enum menu_displaylist_ctl_state type,
          break;
       }
 #endif
+#endif
 #if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
       case DISPLAYLIST_SWITCH_CPU_PROFILE:
       {
diff --git a/menu/menu_setting.c b/menu/menu_setting.c
index ad305b9490..6e68ad11dd 100644
--- a/menu/menu_setting.c
+++ b/menu/menu_setting.c
@@ -8753,15 +8753,6 @@ static bool setting_append_list(
                &subgroup_info,
                parent_group);
 #endif
-#ifdef HAVE_LAKKA_SWITCH
-         CONFIG_ACTION(
-               list, list_info,
-               MENU_ENUM_LABEL_REBOOT,
-               MENU_ENUM_LABEL_VALUE_REBOOT_RCM,
-               &group_info,
-               &subgroup_info,
-               parent_group);
-#else
          CONFIG_ACTION(
                list, list_info,
                MENU_ENUM_LABEL_REBOOT,
@@ -8769,7 +8760,7 @@ static bool setting_append_list(
                &group_info,
                &subgroup_info,
                parent_group);
-#endif
+
          MENU_SETTINGS_LIST_CURRENT_ADD_CMD(list, list_info, CMD_EVENT_REBOOT);
 
          CONFIG_ACTION(
@@ -16359,6 +16350,7 @@ static bool setting_append_list(
 #endif
 
 #ifdef HAVE_LAKKA
+#ifndef HAVE_LAKKA_SWITCH
          CONFIG_ACTION(
                list, list_info,
                MENU_ENUM_LABEL_CPU_PERFPOWER,
@@ -16366,6 +16358,7 @@ static bool setting_append_list(
                &group_info,
                &subgroup_info,
                parent_group);
+#endif
 #endif
 
          END_SUB_GROUP(list, list_info, parent_group);
-- 
2.26.2

